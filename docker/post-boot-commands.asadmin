# -------------------------------------------------------------------------
# 1. 清理旧资源
# -------------------------------------------------------------------------
delete-jdbc-resource jdbc/LuxuryCarRental
delete-jdbc-connection-pool LuxuryCarRentalPool

# -------------------------------------------------------------------------
# 2. 最终修正版创建连接池 (必须是完整、安全的一行!)
# -------------------------------------------------------------------------
# 彻底移除所有换行符和空格陷阱
create-jdbc-connection-pool --datasourceclassname com.mysql.cj.jdbc.MysqlDataSource --restype javax.sql.DataSource --property user=${ENV=DB_USER}:password=${ENV=DB_PASSWORD}:DatabaseName=${ENV=DB_NAME}:ServerName=${ENV=DB_HOST}:PortNumber=${ENV=DB_PORT}:useSSL=false:allowPublicKeyRetrieval=true:validation-required=true:validation-method=auto-commit LuxuryCarRentalPool

# -------------------------------------------------------------------------
# 3. 创建资源
# -------------------------------------------------------------------------
create-jdbc-resource --connectionpoolid LuxuryCarRentalPool jdbc/LuxuryCarRental

# -------------------------------------------------------------------------
# 4. 部署
# -------------------------------------------------------------------------
deploy --force=true --contextroot luxurycarrental /opt/payara/deployments/LuxuryCarRentalService-1.0-SNAPSHOT.war
deploy --force=true --contextroot / /opt/payara/deployments/LuxuryCarRentalWebapp-1.0-SNAPSHOT.war